<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Producto Verificado - W Merch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-white">
    
    <!-- Header -->
    <header class="h-16 bg-white/20 flex items-center px-2">
        <div class="flex items-center space-x-3">
            <img src="/w-merch/logo_w_merch.webp" alt="W Merch" class="w-8 h-8">
            <span class="text-lg font-light text-black">W MERCH</span>
        </div>
        <div class="ml-auto">
            <a href="/buscar" class="text-gray-600 hover:text-black font-light text-sm">← Verificar otro</a>
        </div>
    </header>

    <!-- Main Layout: Dos columnas -->
    <div class="flex" style="height: calc(100vh - 64px);">
        
        <!-- Columna Izquierda: Imágenes -->
        <div class="w-1/2 overflow-y-auto">
            <div class="p-6">
                <div id="imageContainer" class="space-y-6">
                    <!-- Las imágenes se cargarán dinámicamente aquí -->
                </div>
            </div>
        </div>
        
        <!-- Columna Derecha: Información -->
        <div class="w-1/2 bg-white overflow-y-auto">
            <div class="p-8">
                
                <!-- Status -->
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 border border-black mb-4">
                        <svg class="w-8 h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-light text-black mb-2">Producto Auténtico</h1>
                    <p class="text-gray-600 font-light mb-4">Verificación completada</p>
                    <p id="productCode" class="text-xs text-gray-400 font-mono">AUT-2025-WM-B1A7C9D2</p>
                </div>
                
                <!-- Producto -->
                <div class="text-center mb-8">
                    <h2 id="productName" class="text-2xl font-light text-black mb-2">Cargando...</h2>
                    <p id="registrationDate" class="text-gray-600 font-light">Cargando...</p>
                </div>
                
                <!-- Info básica -->
                <div class="space-y-4 mb-8">
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Material</span>
                        <span id="productMaterial" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Color</span>
                        <span id="productColor" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Tipo</span>
                        <span id="productType" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Fabricante</span>
                        <span id="manufacturerName" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Estado</span>
                        <span id="itemStatus" class="font-light text-green-600">Verificado</span>
                    </div>
                </div>
                
                <!-- Certificado -->
                <div class="text-center mb-8">
                    <h3 class="text-xl font-light text-black mb-4">Certificado de Autenticidad</h3>
                    <p class="text-gray-600 font-light text-sm mb-6">Este producto ha sido verificado como 100% auténtico</p>
                    
                    <div class="grid grid-cols-3 gap-4 text-center mb-8">
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Origen</p>
                            <p id="manufacturerCity" class="font-medium text-sm">Cargando...</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Seguridad</p>
                            <p class="font-medium text-sm">Blockchain</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Garantía</p>
                            <p id="warrantyPeriod" class="font-medium text-sm">Cargando...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Acciones -->
                <div class="text-center space-y-4">
                    <button class="border border-black text-black px-6 py-2 font-light hover:bg-black hover:text-white transition-colors">
                        Descargar Certificado
                    </button>
                    <div class="space-y-2">
                        <div><a href="/buscar" class="text-gray-600 hover:text-black font-light text-sm">Verificar otro producto</a></div>
                        <div><a href="/" class="text-gray-400 hover:text-gray-600 font-light text-sm">Volver al inicio</a></div>
                    </div>
                </div>
                
                <!-- Contenido extra para probar scroll -->
                <div class="mt-16 pt-8 border-t border-gray-100">
                    <div class="text-center text-gray-400 text-sm space-y-2">
                        <p>Contenido adicional</p>
                        <p>Línea 1</p>
                        <p>Línea 2</p>
                        <p>Línea 3</p>
                        <p>Línea 4</p>
                        <p>Línea 5</p>
                        <p>Línea 6</p>
                        <p>Línea 7</p>
                        <p>Línea 8</p>
                        <p>Línea 9</p>
                        <p>Línea 10</p>
                        <p>Final del scroll</p>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // Obtener código del producto de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id') || 'AUT-2025-WM-A7B9C2D1';
        console.log('Product ID:', productId);
        
        // Cargar datos desde business.json
        async function loadBusinessData() {
            try {
                console.log('Intentando cargar business.json...');
                const response = await fetch('./business.json');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Datos cargados:', data.products?.length, 'productos');
                return data;
            } catch (error) {
                console.error('Error cargando business.json:', error);
                // Intentar ruta alternativa
                try {
                    console.log('Intentando ruta alternativa: /src/business.json');
                    const response2 = await fetch('/src/business.json');
                    if (response2.ok) {
                        const data = await response2.json();
                        console.log('Datos cargados desde /src/:', data.products?.length, 'productos');
                        return data;
                    }
                } catch (error2) {
                    console.error('Error con ruta alternativa:', error2);
                }
                return null;
            }
        }
        
        // Buscar producto por ID en los items
        function findProductByItemId(data, itemId) {
            for (const product of data.products) {
                const item = product.items.find(item => item.id === itemId);
                if (item) {
                    return {
                        product: product,
                        item: item
                    };
                }
            }
            return null;
        }
        
        // Generar múltiples imágenes desde productImage
        function generateImages(productImage, productName) {
            // Crear variaciones de la imagen principal
            const baseImages = [
                productImage,
                productImage,
                productImage,
                productImage
            ];
            
            // Si no hay imagen, usar placeholder
            return baseImages.map((img, index) => {
                return img || `https://via.placeholder.com/400x400/f3f4f6/9ca3af?text=${encodeURIComponent(productName)}+${index + 1}`;
            });
        }
        
        // Cargar datos del producto
        async function loadProduct() {
            const businessData = await loadBusinessData();
            
            if (!businessData) {
                console.error('No se pudo cargar business.json');
                // Mostrar datos de prueba
                document.getElementById('productName').textContent = 'Error: No se pudo cargar datos';
                document.getElementById('productMaterial').textContent = 'Error de conexión';
                return;
            }
            
            console.log('Buscando producto con ID:', productId);
            const result = findProductByItemId(businessData, productId);
            
            if (!result) {
                console.error('Producto no encontrado:', productId);
                console.log('IDs disponibles:', businessData.products.flatMap(p => p.items.map(i => i.id)).slice(0, 10));
                
                // Mostrar mensaje de error
                document.getElementById('productName').textContent = 'Producto no encontrado';
                document.getElementById('productMaterial').textContent = 'ID no válido';
                return;
            }
            
            const { product, item } = result;
            
            // Actualizar información del producto
            document.getElementById('productCode').textContent = productId;
            document.getElementById('productName').textContent = product.productName;
            document.getElementById('registrationDate').textContent = `Registrado: ${product.registrationDate}`;
            document.getElementById('productMaterial').textContent = product.details.material;
            document.getElementById('productColor').textContent = product.details.color;
            document.getElementById('productType').textContent = product.details.tipo;
            document.getElementById('manufacturerName').textContent = product.manufacturer.name;
            document.getElementById('manufacturerCity').textContent = `${product.manufacturer.city}, ${product.manufacturer.country}`;
            
            // Estado del item
            const statusText = item.status === 'Claimed' ? 'Reclamado' : 'Disponible';
            const statusColor = item.status === 'Claimed' ? 'text-green-600' : 'text-blue-600';
            document.getElementById('itemStatus').textContent = statusText;
            document.getElementById('itemStatus').className = `font-light ${statusColor}`;
            
            // Garantía desde care.repair.warranty o valor por defecto
            const warranty = product.care?.repair?.warranty || '24 meses';
            document.getElementById('warrantyPeriod').textContent = warranty;
            
            // Generar y cargar imágenes
            const images = generateImages(product.productImage, product.productName);
            loadImages(images);
            
            console.log('Producto cargado:', product.productName, 'Item:', item.id, 'Status:', item.status);
        }
        
        // Cargar imágenes dinámicamente
        function loadImages(images) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            
            images.forEach((imageSrc, index) => {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'mb-6 h-[80vh] flex items-center justify-center bg-gray-50 rounded';
                imageDiv.innerHTML = `
                    <img src="${imageSrc}" alt="Producto - Vista ${index + 1}" 
                         class="max-h-full max-w-full object-contain" 
                         onerror="this.src='https://via.placeholder.com/400x400/f3f4f6/9ca3af?text=Imagen+No+Disponible'">
                `;
                container.appendChild(imageDiv);
            });
        }
        
        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            loadProduct();
        });
    </script>
</body>
</html>