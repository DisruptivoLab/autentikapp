<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Producto Verificado - W Merch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        /* Scrollbar personalizado para columna derecha */
        .custom-scrollbar::-webkit-scrollbar {
            width: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #000000;
            border-radius: 0;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #333333;
        }
    </style>
</head>
<body class="bg-white">
    
    <!-- Header -->
    <header class="h-10 bg-white/20 flex items-center px-2">
        <div class="flex items-center space-x-3">
            <img src="/w-merch/logo_w_merch.webp" alt="W Merch" class="w-8 h-8">
            <span class="text-lg font-light text-black">W MERCH</span>
        </div>
        <div class="ml-auto">
            <a href="/buscar" class="text-gray-600 hover:text-black font-light text-sm">‚Üê Verificar otro</a>
        </div>
    </header>

    <!-- Main Layout: Dos columnas -->
    <div class="flex" style="height: calc(100vh - 64px);">
        
        <!-- Columna Izquierda: Im√°genes -->
        <div class="w-1/2 relative">
            <div class="p-0 h-full">
                <div id="imageContainer" class="h-full overflow-hidden" style="scrollbar-width: none; -ms-overflow-style: none;">
                    <!-- Las im√°genes se cargar√°n din√°micamente aqu√≠ -->
                </div>
                
                <!-- Dots verticales -->
                <div id="imageDots" class="absolute left-8 top-1/2 transform -translate-y-1/2 flex flex-col space-y-0">
                    <!-- Los dots se generar√°n din√°micamente -->
                </div>
            </div>
        </div>
        
        <!-- Columna Derecha: Informaci√≥n -->
        <div class="w-1/2 bg-white overflow-y-auto custom-scrollbar">
            <div class="p-8">
                
                <!-- Status -->
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 border border-black mb-4">
                        <svg class="w-8 h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-light text-black mb-2">Producto Aut√©ntico</h1>
                    <p class="text-gray-600 font-light mb-4">Verificaci√≥n completada</p>
                    <p id="productCode" class="text-xs text-gray-400 font-mono">AUT-2025-WM-B1A7C9D2</p>
                </div>
                
                <!-- Producto -->
                <div class="text-center mb-8">
                    <h2 id="productName" class="text-2xl font-light text-black mb-2">Cargando...</h2>
                    <p id="registrationDate" class="text-gray-600 font-light">Cargando...</p>
                </div>
                
                <!-- Info b√°sica -->
                <div class="space-y-4 mb-8">
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Material</span>
                        <span id="productMaterial" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Color</span>
                        <span id="productColor" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Tipo</span>
                        <span id="productType" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Fabricante</span>
                        <span id="manufacturerName" class="font-light">Cargando...</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-600">Estado</span>
                        <span id="itemStatus" class="font-light text-green-600">Verificado</span>
                    </div>
                </div>
                
                <!-- Certificado -->
                <div class="text-center mb-8">
                    <h3 class="text-xl font-light text-black mb-4">Certificado de Autenticidad</h3>
                    <p class="text-gray-600 font-light text-sm mb-6">Este producto ha sido verificado como 100% aut√©ntico</p>
                    
                    <div class="grid grid-cols-3 gap-4 text-center mb-8">
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Origen</p>
                            <p id="manufacturerCity" class="font-medium text-sm">Cargando...</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Seguridad</p>
                            <p class="font-medium text-sm">Blockchain</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Garant√≠a</p>
                            <p id="warrantyPeriod" class="font-medium text-sm">Cargando...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Acciones -->
                <div class="text-center space-y-4">
                    <button class="border border-black text-black px-6 py-2 font-light hover:bg-black hover:text-white transition-colors">
                        Descargar Certificado
                    </button>
                    <div class="space-y-2">
                        <div><a href="/buscar" class="text-gray-600 hover:text-black font-light text-sm">Verificar otro producto</a></div>
                        <div><a href="/" class="text-gray-400 hover:text-gray-600 font-light text-sm">Volver al inicio</a></div>
                    </div>
                </div>
                
                <!-- Contenido extra para probar scroll -->
                <div class="mt-16 pt-8 border-t border-gray-100">
                    <div class="text-center text-gray-400 text-sm space-y-2">
                        <p>Contenido adicional</p>
                        <p>L√≠nea 1</p>
                        <p>L√≠nea 2</p>
                        <p>L√≠nea 3</p>
                        <p>L√≠nea 4</p>
                        <p>L√≠nea 5</p>
                        <p>L√≠nea 6</p>
                        <p>L√≠nea 7</p>
                        <p>L√≠nea 8</p>
                        <p>L√≠nea 9</p>
                        <p>L√≠nea 10</p>
                        <p>Final del scroll</p>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // Obtener c√≥digo del producto de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id') || 'AUT-2025-WM-A7B9C2D1';
        console.log('üîç Product ID desde URL:', productId);
        console.log('üåê URL completa:', window.location.href);
        
        // Cargar datos desde business.json
        async function loadBusinessData() {
            const routes = ['./business.json', '/business.json', '/src/business.json'];
            
            for (const route of routes) {
                try {
                    console.log(`Intentando cargar: ${route}`);
                    const response = await fetch(route);
                    console.log(`Response status para ${route}:`, response.status);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('‚úÖ Datos cargados exitosamente:', data.products?.length, 'productos');
                        console.log('‚úÖ Ruta exitosa:', route);
                        return data;
                    }
                } catch (error) {
                    console.error(`‚ùå Error con ${route}:`, error.message);
                }
            }
            
            console.error('‚ùå No se pudo cargar business.json desde ninguna ruta');
            return null;
        }
        
        // Buscar producto por ID en los items
        function findProductByItemId(data, itemId) {
            for (const product of data.products) {
                const item = product.items.find(item => item.id === itemId);
                if (item) {
                    return {
                        product: product,
                        item: item
                    };
                }
            }
            return null;
        }
        
        // Generar m√∫ltiples im√°genes desde productImage
        function generateImages(productImage, productName) {
            // Crear variaciones de la imagen principal
            const baseImages = [
                productImage,
                productImage,
                productImage,
                productImage
            ];
            
            // Si no hay imagen, usar placeholder
            return baseImages.map((img, index) => {
                return img || `https://via.placeholder.com/400x400/f3f4f6/9ca3af?text=${encodeURIComponent(productName)}+${index + 1}`;
            });
        }
        
        // Cargar datos del producto
        async function loadProduct() {
            const businessData = await loadBusinessData();
            
            if (!businessData) {
                console.error('No se pudo cargar business.json');
                // Mostrar datos de prueba
                document.getElementById('productName').textContent = 'Error: No se pudo cargar datos';
                document.getElementById('productMaterial').textContent = 'Error de conexi√≥n';
                return;
            }
            
            console.log('Buscando producto con ID:', productId);
            const result = findProductByItemId(businessData, productId);
            
            if (!result) {
                console.error('Producto no encontrado:', productId);
                console.log('IDs disponibles:', businessData.products.flatMap(p => p.items.map(i => i.id)).slice(0, 10));
                
                // Mostrar mensaje de error
                document.getElementById('productName').textContent = 'Producto no encontrado';
                document.getElementById('productMaterial').textContent = 'ID no v√°lido';
                return;
            }
            
            const { product, item } = result;
            
            // Actualizar informaci√≥n del producto
            document.getElementById('productCode').textContent = productId;
            document.getElementById('productName').textContent = product.productName;
            document.getElementById('registrationDate').textContent = `Registrado: ${product.registrationDate}`;
            document.getElementById('productMaterial').textContent = product.details.material;
            document.getElementById('productColor').textContent = product.details.color;
            document.getElementById('productType').textContent = product.details.tipo;
            document.getElementById('manufacturerName').textContent = product.manufacturer.name;
            document.getElementById('manufacturerCity').textContent = `${product.manufacturer.city}, ${product.manufacturer.country}`;
            
            // Estado del item
            const statusText = item.status === 'Claimed' ? 'Reclamado' : 'Disponible';
            const statusColor = item.status === 'Claimed' ? 'text-green-600' : 'text-blue-600';
            document.getElementById('itemStatus').textContent = statusText;
            document.getElementById('itemStatus').className = `font-light ${statusColor}`;
            
            // Garant√≠a desde care.repair.warranty o valor por defecto
            const warranty = product.care?.repair?.warranty || '24 meses';
            document.getElementById('warrantyPeriod').textContent = warranty;
            
            // Generar y cargar im√°genes
            const images = generateImages(product.productImage, product.productName);
            loadImages(images);
            
            console.log('Producto cargado:', product.productName, 'Item:', item.id, 'Status:', item.status);
        }
        
        // Variables del carrusel
        let currentImageIndex = 0;
        let totalImages = 0;
        
        // Cargar im√°genes din√°micamente
        function loadImages(images) {
            const container = document.getElementById('imageContainer');
            const dotsContainer = document.getElementById('imageDots');
            container.innerHTML = '';
            dotsContainer.innerHTML = '';
            
            totalImages = images.length;
            currentImageIndex = 0;
            
            // Crear contenedor de im√°genes vertical
            const imagesWrapper = document.createElement('div');
            imagesWrapper.className = 'flex flex-col transition-transform duration-300 ease-in-out';
            imagesWrapper.style.height = `${totalImages * 80}vh`;
            imagesWrapper.id = 'imagesWrapper';
            
            images.forEach((imageSrc, index) => {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'flex-shrink-0 h-[80vh] flex items-center justify-center';
                imageDiv.innerHTML = `
                    <img src="${imageSrc}" alt="Producto - Vista ${index + 1}" 
                         class="max-h-full max-w-full object-contain" 
                         onerror="this.src='https://via.placeholder.com/400x400/f3f4f6/9ca3af?text=Imagen+No+Disponible'">
                `;
                imagesWrapper.appendChild(imageDiv);
                
                // Crear dot vertical
                const dot = document.createElement('div');
                dot.className = `w-1 h-12 cursor-pointer transition-all duration-200 ${index === 0 ? 'bg-black' : 'bg-gray-300 hover:bg-gray-400'}`;
                dot.addEventListener('click', () => goToImage(index));
                dotsContainer.appendChild(dot);
            });
            
            container.appendChild(imagesWrapper);
            
            // Agregar eventos de teclado
            document.addEventListener('keydown', handleKeyboard);
            
            // Agregar scroll wheel
            container.addEventListener('wheel', handleWheel);
        }
        
        // Navegar a imagen espec√≠fica
        function goToImage(index) {
            if (index < 0 || index >= totalImages) return;
            
            currentImageIndex = index;
            const wrapper = document.getElementById('imagesWrapper');
            const translateY = -(index * 70);
            wrapper.style.transform = `translateY(${translateY}vh)`;
            
            // Actualizar dots
            const dots = document.querySelectorAll('#imageDots > div');
            dots.forEach((dot, i) => {
                dot.className = `w-1 h-12 cursor-pointer transition-all duration-200 ${i === index ? 'bg-black' : 'bg-gray-300 hover:bg-gray-400'}`;
            });
        }
        
        // Manejar teclado
        function handleKeyboard(e) {
            if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                e.preventDefault();
                goToImage(currentImageIndex - 1);
            } else if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                e.preventDefault();
                goToImage(currentImageIndex + 1);
            }
        }
        
        // Manejar scroll wheel
        function handleWheel(e) {
            e.preventDefault();
            if (e.deltaY > 0) {
                goToImage(currentImageIndex + 1);
            } else {
                goToImage(currentImageIndex - 1);
            }
        }
        
        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            loadProduct();
        });
    </script>
</body>
</html>